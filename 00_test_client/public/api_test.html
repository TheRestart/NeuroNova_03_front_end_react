<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroNova API í…ŒìŠ¤íŠ¸ í˜ì´ì§€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        .content {
            padding: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            margin: 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }
        .test-button:active {
            transform: translateY(0);
        }
        .test-button.success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        .test-button.danger {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }
        .result {
            margin-top: 15px;
            padding: 20px;
            background: white;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: 10px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .status.pending {
            background: #fff3cd;
            color: #856404;
        }
        .token-display {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            word-break: break-all;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .info-box {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border-left: 3px solid #667eea;
        }
        .info-box strong {
            color: #667eea;
            display: block;
            margin-bottom: 5px;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¥ NeuroNova CDSS API í…ŒìŠ¤íŠ¸</h1>
            <p>ë°°í¬ ì „ Django REST API ê²€ì¦ ë„êµ¬</p>
        </div>

        <div class="content">
            <!-- ì¸ì¦ ì„¹ì…˜ -->
            <div class="section">
                <h2>ğŸ” UC01: ì¸ì¦ (Authentication)</h2>
                <button class="test-button" onclick="testLogin()">ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ (doctor/doctor123)</button>
                <button class="test-button success" onclick="testTokenRefresh()">í† í° ê°±ì‹  í…ŒìŠ¤íŠ¸</button>
                <div id="auth-result" class="result" style="display:none;"></div>
                <div id="token-display" class="token-display" style="display:none;">
                    <strong>Access Token:</strong>
                    <div id="access-token" style="font-size: 0.8em; margin-top: 5px;"></div>
                    <strong style="margin-top: 10px; display: block;">Refresh Token:</strong>
                    <div id="refresh-token" style="font-size: 0.8em; margin-top: 5px;"></div>
                </div>
            </div>

            <!-- EMR ì„¹ì…˜ -->
            <div class="section">
                <h2>ğŸ“‹ UC02: EMR (Electronic Medical Records)</h2>
                <button class="test-button" onclick="testPatientList()">í™˜ì ëª©ë¡ ì¡°íšŒ</button>
                <button class="test-button" onclick="testPatientDetail()">í™˜ì ìƒì„¸ ì¡°íšŒ (P20250001)</button>
                <div id="emr-result" class="result" style="display:none;"></div>
            </div>

            <!-- OCS ì„¹ì…˜ -->
            <div class="section">
                <h2>ğŸ’Š UC03: OCS (Order Communication System)</h2>
                <button class="test-button" onclick="testOrderList()">ì˜¤ë” ëª©ë¡ ì¡°íšŒ</button>
                <button class="test-button" onclick="testOrderCreate()">ì‹ ê·œ ì˜¤ë” ìƒì„±</button>
                <div id="ocs-result" class="result" style="display:none;"></div>
            </div>

            <!-- LIS ì„¹ì…˜ -->
            <div class="section">
                <h2>ğŸ”¬ UC04: LIS (Laboratory Information System)</h2>
                <button class="test-button" onclick="testLabTestList()">ê²€ì‚¬ ëª©ë¡ ì¡°íšŒ</button>
                <button class="test-button" onclick="testLabResultList()">ê²€ì‚¬ ê²°ê³¼ ì¡°íšŒ</button>
                <div id="lis-result" class="result" style="display:none;"></div>
            </div>

            <!-- RIS ì„¹ì…˜ -->
            <div class="section">
                <h2>ğŸ©» UC05: RIS (Radiology Information System)</h2>
                <button class="test-button" onclick="testStudyList()">ì˜ìƒ ê²€ì‚¬ ëª©ë¡</button>
                <button class="test-button" onclick="testDicomWeb()">DICOMweb ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                <div id="ris-result" class="result" style="display:none;"></div>
            </div>

            <!-- AI ì„¹ì…˜ -->
            <div class="section">
                <h2>ğŸ¤– UC06: AI Jobs</h2>
                <button class="test-button danger" onclick="testAIJobs()">AI Jobs ì¡°íšŒ (500 ì—ëŸ¬ ì˜ˆìƒ)</button>
                <div id="ai-result" class="result" style="display:none;"></div>
                <p style="margin-top: 10px; color: #721c24; font-size: 0.9em;">
                    âš ï¸ ì•Œë ¤ì§„ ì´ìŠˆ: ORM select_related í•„ë“œ ì—ëŸ¬ (ë°°í¬ ë²”ìœ„ ì™¸)
                </p>
            </div>

            <!-- ê°ì‚¬ ë¡œê·¸ ì„¹ì…˜ -->
            <div class="section">
                <h2>ğŸ“Š UC09: ê°ì‚¬ ë¡œê·¸ (Audit Log)</h2>
                <button class="test-button" onclick="testAuditLog()">ê°ì‚¬ ë¡œê·¸ ì¡°íšŒ</button>
                <div id="audit-result" class="result" style="display:none;"></div>
            </div>

            <!-- ì‹œìŠ¤í…œ ì •ë³´ -->
            <div class="section">
                <h2>â„¹ï¸ ì‹œìŠ¤í…œ ì •ë³´</h2>
                <div class="grid">
                    <div class="info-box">
                        <strong>API Base URL</strong>
                        http://localhost/api
                    </div>
                    <div class="info-box">
                        <strong>DICOMweb Root</strong>
                        http://localhost/api/ris/dicom-web
                    </div>
                    <div class="info-box">
                        <strong>í…ŒìŠ¤íŠ¸ ê³„ì •</strong>
                        doctor / doctor123
                    </div>
                    <div class="info-box">
                        <strong>ìƒ˜í”Œ í™˜ì</strong>
                        P20250001 ~ P20250005
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost/api';
        let accessToken = null;
        let refreshToken = null;

        // ê²°ê³¼ í‘œì‹œ í—¬í¼
        function showResult(elementId, data, isError = false) {
            const el = document.getElementById(elementId);
            el.style.display = 'block';
            el.style.borderLeft = isError ? '4px solid #eb3349' : '4px solid #11998e';
            el.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
        }

        // UC01: ë¡œê·¸ì¸
        async function testLogin() {
            try {
                showResult('auth-result', 'ë¡œê·¸ì¸ ìš”ì²­ ì¤‘...');
                const response = await fetch(`${API_BASE}/acct/login/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'doctor', password: 'doctor123' })
                });

                const data = await response.json();

                if (response.ok) {
                    accessToken = data.access;
                    refreshToken = data.refresh;
                    showResult('auth-result', data);

                    // í† í° í‘œì‹œ
                    document.getElementById('token-display').style.display = 'block';
                    document.getElementById('access-token').textContent = accessToken;
                    document.getElementById('refresh-token').textContent = refreshToken;
                } else {
                    showResult('auth-result', data, true);
                }
            } catch (error) {
                showResult('auth-result', `ì—ëŸ¬: ${error.message}`, true);
            }
        }

        // UC01: í† í° ê°±ì‹ 
        async function testTokenRefresh() {
            if (!refreshToken) {
                alert('ë¨¼ì € ë¡œê·¸ì¸ì„ ìˆ˜í–‰í•˜ì„¸ìš”.');
                return;
            }

            try {
                showResult('auth-result', 'í† í° ê°±ì‹  ì¤‘...');
                const response = await fetch(`${API_BASE}/acct/token/refresh/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ refresh: refreshToken })
                });

                const data = await response.json();

                if (response.ok) {
                    accessToken = data.access;
                    showResult('auth-result', data);
                    document.getElementById('access-token').textContent = accessToken;
                } else {
                    showResult('auth-result', data, true);
                }
            } catch (error) {
                showResult('auth-result', `ì—ëŸ¬: ${error.message}`, true);
            }
        }

        // ì¸ì¦ í—¤ë” ìƒì„±
        function getAuthHeaders() {
            if (!accessToken) {
                throw new Error('ë¨¼ì € ë¡œê·¸ì¸ì„ ìˆ˜í–‰í•˜ì„¸ìš”.');
            }
            return {
                'Authorization': `Bearer ${accessToken}`,
                'Content-Type': 'application/json'
            };
        }

        // UC02: í™˜ì ëª©ë¡
        async function testPatientList() {
            try {
                showResult('emr-result', 'í™˜ì ëª©ë¡ ì¡°íšŒ ì¤‘...');
                const response = await fetch(`${API_BASE}/emr/patients/`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                showResult('emr-result', data, !response.ok);
            } catch (error) {
                showResult('emr-result', `ì—ëŸ¬: ${error.message}`, true);
            }
        }

        // UC02: í™˜ì ìƒì„¸
        async function testPatientDetail() {
            try {
                showResult('emr-result', 'í™˜ì ìƒì„¸ ì¡°íšŒ ì¤‘...');
                const response = await fetch(`${API_BASE}/emr/patients/P20250001/`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                showResult('emr-result', data, !response.ok);
            } catch (error) {
                showResult('emr-result', `ì—ëŸ¬: ${error.message}`, true);
            }
        }

        // UC03: ì˜¤ë” ëª©ë¡
        async function testOrderList() {
            try {
                showResult('ocs-result', 'ì˜¤ë” ëª©ë¡ ì¡°íšŒ ì¤‘...');
                const response = await fetch(`${API_BASE}/ocs/orders/`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                showResult('ocs-result', data, !response.ok);
            } catch (error) {
                showResult('ocs-result', `ì—ëŸ¬: ${error.message}`, true);
            }
        }

        // UC03: ì˜¤ë” ìƒì„±
        async function testOrderCreate() {
            try {
                showResult('ocs-result', 'ì‹ ê·œ ì˜¤ë” ìƒì„± ì¤‘...');
                const orderData = {
                    patient_id: 'P20250001',
                    order_type: 'lab',
                    order_code: 'CBC',
                    priority: 'routine',
                    clinical_info: 'API í…ŒìŠ¤íŠ¸ ì˜¤ë”'
                };

                const response = await fetch(`${API_BASE}/ocs/orders/`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify(orderData)
                });
                const data = await response.json();
                showResult('ocs-result', data, !response.ok);
            } catch (error) {
                showResult('ocs-result', `ì—ëŸ¬: ${error.message}`, true);
            }
        }

        // UC04: ê²€ì‚¬ ëª©ë¡
        async function testLabTestList() {
            try {
                showResult('lis-result', 'ê²€ì‚¬ ëª©ë¡ ì¡°íšŒ ì¤‘...');
                const response = await fetch(`${API_BASE}/lis/lab-tests/`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                showResult('lis-result', data, !response.ok);
            } catch (error) {
                showResult('lis-result', `ì—ëŸ¬: ${error.message}`, true);
            }
        }

        // UC04: ê²€ì‚¬ ê²°ê³¼
        async function testLabResultList() {
            try {
                showResult('lis-result', 'ê²€ì‚¬ ê²°ê³¼ ì¡°íšŒ ì¤‘...');
                const response = await fetch(`${API_BASE}/lis/lab-results/`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                showResult('lis-result', data, !response.ok);
            } catch (error) {
                showResult('lis-result', `ì—ëŸ¬: ${error.message}`, true);
            }
        }

        // UC05: ì˜ìƒ ê²€ì‚¬ ëª©ë¡
        async function testStudyList() {
            try {
                showResult('ris-result', 'ì˜ìƒ ê²€ì‚¬ ëª©ë¡ ì¡°íšŒ ì¤‘...');
                const response = await fetch(`${API_BASE}/ris/studies/`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                showResult('ris-result', data, !response.ok);
            } catch (error) {
                showResult('ris-result', `ì—ëŸ¬: ${error.message}`, true);
            }
        }

        // UC05: DICOMweb í…ŒìŠ¤íŠ¸
        async function testDicomWeb() {
            try {
                showResult('ris-result', 'DICOMweb ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...');
                const response = await fetch(`${API_BASE}/ris/dicom-web/studies/`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                showResult('ris-result', data, !response.ok);
            } catch (error) {
                showResult('ris-result', `ì—ëŸ¬: ${error.message}`, true);
            }
        }

        // UC06: AI Jobs (ì—ëŸ¬ ì˜ˆìƒ)
        async function testAIJobs() {
            try {
                showResult('ai-result', 'AI Jobs ì¡°íšŒ ì¤‘...');
                const response = await fetch(`${API_BASE}/ai/jobs/`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                showResult('ai-result', data, !response.ok);
            } catch (error) {
                showResult('ai-result', `ì—ëŸ¬: ${error.message}`, true);
            }
        }

        // UC09: ê°ì‚¬ ë¡œê·¸
        async function testAuditLog() {
            try {
                showResult('audit-result', 'ê°ì‚¬ ë¡œê·¸ ì¡°íšŒ ì¤‘...');
                const response = await fetch(`${API_BASE}/audit/logs/`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                showResult('audit-result', data, !response.ok);
            } catch (error) {
                showResult('audit-result', `ì—ëŸ¬: ${error.message}`, true);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì•ˆë‚´
        window.addEventListener('load', () => {
            console.log('NeuroNova API í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            console.log('ë¨¼ì € "ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì¸ì¦ í† í°ì„ íšë“í•˜ì„¸ìš”.');
        });
    </script>
</body>
</html>

# NeuroNova CDSS 테스트 클라이언트 사용 방법

**작성일**: 2025-12-31
**버전**: 1.0
**대상**: NeuroNova CDSS v2.0 Phase 2 완료 후 통합 테스트

---

## 목차

1. [개요](#1-개요)
2. [시스템 요구사항](#2-시스템-요구사항)
3. [서버 시작하기](#3-서버-시작하기)
4. [로그인 방법](#4-로그인-방법)
5. [데이터베이스 초기 설정](#5-데이터베이스-초기-설정)
6. [주요 기능 테스트](#6-주요-기능-테스트)
7. [문제 해결](#7-문제-해결)
8. [알려진 제약사항](#8-알려진-제약사항)

---

## 1. 개요

이 테스트 클라이언트는 NeuroNova CDSS 백엔드 API를 검증하기 위한 React 애플리케이션입니다.

### 주요 기능
- 9개 Use Case (UC01~UC09) API 테스트
- OHIF Viewer v3.8.0 통합 (DICOM 이미지 뷰어)
- JWT 기반 인증
- 실시간 API 응답 확인

### 기술 스택
- React 18.2.0
- React Router 6.20.0
- Axios 1.6.0
- OHIF Viewer 3.8.0
- Cornerstone DICOM Viewer

---

## 2. 시스템 요구사항

### 필수 환경

| 구성 요소 | 요구사항 | 비고 |
|----------|---------|------|
| **Django 백엔드** | Docker 14 컨테이너 실행 중 | http://localhost:8000 |
| **Node.js** | v20.19.6 | WSL Ubuntu-22.04 LTS 권장 |
| **npm** | 10.8.2 | WSL Ubuntu-22.04 LTS 권장 |
| **브라우저** | Chrome/Edge 최신 버전 | |
| **운영체제** | Windows 10/11 + WSL Ubuntu-22.04 | |

### 선택 환경
- **Orthanc PACS**: RIS/DICOM 테스트 시 필요 (http://localhost:8042)
- **Redis**: 캐싱 및 Celery 작업 큐
- **PostgreSQL**: 메인 데이터베이스

---

## 3. 서버 시작하기

### 3-1. Django 백엔드 확인

Django 서버가 Docker에서 실행 중인지 확인:

```bash
docker ps | grep django
```

**출력 예시**:
```
neuronova-django-dev   Up 2 hours   0.0.0.0:8000->8000/tcp
```

Django 서버 상태 확인:
```bash
curl http://localhost:8000/api/auth/health/
```

### 3-2. React 프론트엔드 시작

**CRITICAL**: React는 반드시 **WSL Ubuntu-22.04 LTS** 환경에서 실행해야 합니다.

```bash
# WSL Ubuntu 진입
wsl -d Ubuntu-22.04

# 프로젝트 디렉토리 이동
cd /mnt/d/1222/NeuroNova_v1/NeuroNova_03_front_end_react/00_test_client

# 패키지 설치 (최초 1회)
npm install --legacy-peer-deps

# 개발 서버 시작 (포트 3001)
PORT=3001 npm start
```

**성공 시 출력**:
```
Compiled successfully!

You can now view cdss-api-test-client in the browser.

  Local:            http://localhost:3001
  On Your Network:  http://172.29.66.53:3001
```

브라우저에서 `http://localhost:3001` 접속

---

## 4. 로그인 방법

### 4-1. 빠른 로그인 (권장)

로그인 페이지에서 역할별 버튼을 클릭하면 자동으로 로그인됩니다:

| 버튼 | 역할 | 접근 가능 기능 |
|------|------|---------------|
| **Admin** | 관리자 | 모든 기능 |
| **Doctor** | 의사 | EMR, OCS, LIS, RIS, AI |
| **Nurse** | 간호사 | EMR, OCS |
| **Patient** | 환자 | 본인 정보만 |
| **Radiologist** | 방사선사 | RIS |
| **Lab Tech** | 검사실 기사 | LIS |

### 4-2. 수동 로그인

아이디와 비밀번호를 직접 입력:

| 아이디 | 비밀번호 | 역할 |
|--------|----------|------|
| admin | admin123 | 관리자 |
| doctor | doctor123 | 의사 |
| nurse | nurse123 | 간호사 |
| patient | patient123 | 환자 |
| radiologist | radiologist123 | 방사선사 |
| labtech | labtech123 | 검사실 기사 |

### 4-3. 로그인 문제 해결

**오류**: "로그인에 실패했습니다"

**해결**:
1. Django 서버 실행 확인 (`docker ps`)
2. 브라우저 콘솔(F12) 확인
3. 테스트 계정이 없으면 생성:
   ```bash
   docker exec neuronova-django-dev python manage.py create_test_users
   ```

---

## 5. 데이터베이스 초기 설정

로그인 후 데이터가 없으면 다음 스크립트를 순서대로 실행:

### 5-1. 마스터 데이터 시딩 (진단, 약물, 검사 코드)

```bash
docker exec neuronova-django-dev python manage.py seed_master_data
```

**생성 데이터**:
- 진단 코드 (ICD-10): 100개
- 약물 코드: 30개
- 검사 코드: 47개

### 5-2. 샘플 환자 데이터 생성

```bash
docker exec neuronova-django-dev python manage.py init_sample_data
```

**생성 데이터**:
- 환자 5명 (P20250001~P20250005)
- 사용자 17명 (역할별)

### 5-3. DICOM 샘플 업로드 (선택)

DICOM 파일이 있는 경우:

```bash
docker exec neuronova-django-dev python manage.py upload_sample_dicoms
```

**참고**: sample_dicoms 디렉토리가 없으면 이 단계는 건너뜁니다.

---

## 6. 주요 기능 테스트

### 6-1. UC02: EMR (전자의무기록)

1. 상단 메뉴에서 **"UC02: EMR"** 클릭
2. "환자 목록 조회" 섹션에서 **"API 호출"** 클릭
3. 5명의 환자 목록 확인:
   - P20250001: Kim MinJun
   - P20250002: Lee SeoYun
   - P20250003: Park JiHoon
   - P20250004: Choi YeJin
   - P20250005: Jung DoHyun

### 6-2. UC03: OCS (처방전달시스템)

1. **"UC03: OCS"** 메뉴 클릭
2. "처방 생성" 섹션:
   - 환자 ID: P20250001
   - Order Type: medication
   - 약물 코드 선택
3. **"API 호출"** 클릭
4. 처방 생성 확인

### 6-3. UC04: LIS (검체검사시스템)

1. **"UC04: LIS"** 메뉴 클릭
2. "검사 결과 생성":
   - 환자 ID: P20250001
   - 검사 항목 선택 (예: CBC, Glucose)
3. 검사 결과 조회 및 확인

### 6-4. UC05: RIS (영상검사시스템) + OHIF Viewer

**현재 상태**: Orthanc에 DICOM 데이터 없음

1. **"UC05: RIS"** 메뉴 클릭
2. Orthanc 환자 목록 섹션:
   - "Orthanc에 등록된 환자가 없습니다" 메시지 표시

**DICOM 데이터 업로드 후**:
1. "View Study" 버튼 클릭
2. DICOM Viewer 페이지로 이동
3. OHIF Viewer에서 영상 확인

### 6-5. UC06: AI 추론

1. **"UC06: AI"** 메뉴 클릭
2. "뇌졸중 위험도 예측":
   - 환자 정보 입력 (나이, 혈압, BMI 등)
3. **"API 호출"** 클릭
4. AI 분석 결과 확인 (위험도 %, 권장사항)

### 6-6. UC08: FHIR R4

1. **"UC08: FHIR"** 메뉴 클릭
2. "Patient 리소스 검색":
   - 이름으로 검색: Kim
3. FHIR R4 표준 형식의 응답 확인

### 6-7. UC09: 감사 로그

1. **관리자 계정으로 로그인** (admin)
2. **"UC09: 감사로그"** 메뉴 클릭
3. "감사 로그 조회":
   - 날짜 범위 선택
4. 사용자 활동 이력 확인

---

## 7. 문제 해결

### 7-1. "Orthanc에 등록된 환자가 없습니다"

**원인**: Orthanc PACS에 DICOM 데이터 없음

**해결**:
1. sample_dicoms 디렉토리 준비
2. DICOM 업로드 스크립트 실행
3. 또는 Orthanc 웹 UI에서 수동 업로드:
   - http://localhost:8042 접속
   - Upload → DICOM 파일 선택

### 7-2. Proxy 오류 (favicon.ico)

```
Proxy error: Could not proxy request /favicon.ico
```

**원인**: Django가 favicon을 제공하지 않음 (정상 동작)

**해결**: 무시해도 됨 (다른 API는 정상 작동)

### 7-3. 포트 3000이 이미 사용 중

```
Something is already running on port 3000
```

**해결**:
```bash
# 포트 3001 사용
PORT=3001 npm start
```

### 7-4. React 컴파일 오류

**오류**: Git merge conflict markers

**해결**:
```bash
# WSL Ubuntu에서
cd /mnt/d/1222/NeuroNova_v1/NeuroNova_03_front_end_react/00_test_client
git status
git diff
```

파일 충돌 해결 후 재시작

### 7-5. Django 서버 연결 실패

**오류**: "Network Error"

**해결**:
1. Docker 컨테이너 확인:
   ```bash
   docker ps | grep django
   ```
2. Django 로그 확인:
   ```bash
   docker logs neuronova-django-dev --tail 50
   ```
3. 컨테이너 재시작:
   ```bash
   docker restart neuronova-django-dev
   ```

---

## 8. 알려진 제약사항

### 8-1. WSL Ubuntu 필수

- **React npm start는 반드시 WSL Ubuntu-22.04 LTS에서 실행**
- Windows 네이티브 환경에서 실행 시 오류 발생

### 8-2. OHIF Viewer 통합

- OHIF Viewer v3.8.0 패키지 설치 완료
- **현재는 메타데이터만 표시** (임시 구현)
- 전체 DICOM 뷰어 기능은 추가 개발 필요

### 8-3. DICOM 데이터

- sample_dicoms 디렉토리 없음
- Orthanc에 DICOM 데이터 수동 업로드 필요
- 또는 별도 DICOM 파일 준비

### 8-4. FHIR 동기화 오류

```
ERROR: FHIR sync failed for Patient P20250001: 'str' object has no attribute 'isoformat'
```

**영향**: 없음 (환자 데이터는 정상 생성됨)

### 8-5. 보안

- JWT 토큰이 localStorage에 저장 (개발 환경 전용)
- HTTP 사용 (HTTPS 아님)
- 테스트 계정 하드코딩
- **운영 환경에 배포 금지**

---

## 부록: 빠른 참조

### 서버 시작 체크리스트

- [ ] Docker 컨테이너 14개 실행 확인
- [ ] Django 서버 http://localhost:8000 응답 확인
- [ ] WSL Ubuntu-22.04 진입
- [ ] npm install --legacy-peer-deps (최초 1회)
- [ ] PORT=3001 npm start
- [ ] 브라우저에서 http://localhost:3001 접속
- [ ] 로그인 (admin / admin123)

### 주요 URL

| 서비스 | URL | 비고 |
|--------|-----|------|
| React 클라이언트 | http://localhost:3001 | WSL Ubuntu에서 실행 |
| Django API | http://localhost:8000 | Docker |
| Swagger UI | http://localhost:8000/api/docs/ | API 문서 |
| Orthanc PACS | http://localhost:8042 | DICOM 서버 |
| Prometheus | http://localhost:9090 | 모니터링 |
| Grafana | http://localhost:3003 | 대시보드 |

### 데이터 초기화 명령어

```bash
# 1. 테스트 사용자 생성 (17명)
docker exec neuronova-django-dev python manage.py create_test_users

# 2. 마스터 데이터 시딩 (77개)
docker exec neuronova-django-dev python manage.py seed_master_data

# 3. 샘플 환자 생성 (5명)
docker exec neuronova-django-dev python manage.py init_sample_data

# 4. DICOM 업로드 (선택)
docker exec neuronova-django-dev python manage.py upload_sample_dicoms
```

---

**작성**: NeuroNova Development Team
**최종 업데이트**: 2025-12-31
**문서 버전**: 1.0
**프로젝트 상태**: Phase 2 완료, Week 7 완료
